<svg width="1400" height="2000" xmlns="http://www.w3.org/2000/svg">
  <!-- Title -->
  <text x="700" y="30" font-family="Arial, sans-serif" font-size="28" font-weight="bold" text-anchor="middle" fill="#2c3e50">
    BusFlow - System Architecture
  </text>
  
  <!-- ==================== CLIENT LAYER ==================== -->
  <g id="client-layer">
    <!-- Main Container -->
    <rect x="50" y="60" width="1300" height="480" fill="#e3f2fd" stroke="#1976d2" stroke-width="3" rx="10"/>
    <text x="700" y="90" font-family="Arial" font-size="20" font-weight="bold" text-anchor="middle" fill="#1565c0">
      CLIENT LAYER (Port 3001)
    </text>
    <line x1="50" y1="100" x2="1350" y2="100" stroke="#1976d2" stroke-width="2"/>
    
    <!-- React Application Box -->
    <rect x="100" y="130" width="1200" height="380" fill="#ffffff" stroke="#42a5f5" stroke-width="2" rx="8"/>
    <text x="700" y="160" font-family="Arial" font-size="18" font-weight="bold" text-anchor="middle" fill="#1565c0">
      React Web Application (SPA)
    </text>
    
    <!-- Component Row 1 -->
    <rect x="140" y="180" width="240" height="60" fill="#bbdefb" stroke="#1976d2" stroke-width="2" rx="5"/>
    <text x="260" y="207" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle">Home</text>
    <text x="260" y="224" font-family="Arial" font-size="12" text-anchor="middle">Dashboard</text>
    
    <rect x="400" y="180" width="240" height="60" fill="#bbdefb" stroke="#1976d2" stroke-width="2" rx="5"/>
    <text x="520" y="215" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle">Track Bus</text>
    
    <rect x="660" y="180" width="240" height="60" fill="#bbdefb" stroke="#1976d2" stroke-width="2" rx="5"/>
    <text x="780" y="207" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle">Journey</text>
    <text x="780" y="224" font-family="Arial" font-size="12" text-anchor="middle">Planner</text>
    
    <rect x="920" y="180" width="240" height="60" fill="#bbdefb" stroke="#1976d2" stroke-width="2" rx="5"/>
    <text x="1040" y="207" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle">Crowd</text>
    <text x="1040" y="224" font-family="Arial" font-size="12" text-anchor="middle">Prediction</text>
    
    <!-- Component Row 2 -->
    <rect x="140" y="260" width="240" height="60" fill="#bbdefb" stroke="#1976d2" stroke-width="2" rx="5"/>
    <text x="260" y="287" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle">Fare</text>
    <text x="260" y="304" font-family="Arial" font-size="12" text-anchor="middle">Calculator</text>
    
    <rect x="400" y="260" width="240" height="60" fill="#bbdefb" stroke="#1976d2" stroke-width="2" rx="5"/>
    <text x="520" y="287" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle">Search</text>
    <text x="520" y="304" font-family="Arial" font-size="12" text-anchor="middle">Route</text>
    
    <rect x="660" y="260" width="240" height="60" fill="#bbdefb" stroke="#1976d2" stroke-width="2" rx="5"/>
    <text x="780" y="287" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle">Admin</text>
    <text x="780" y="304" font-family="Arial" font-size="12" text-anchor="middle">Dashboard</text>
    
    <rect x="920" y="260" width="240" height="60" fill="#bbdefb" stroke="#1976d2" stroke-width="2" rx="5"/>
    <text x="1040" y="295" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle">Feedback</text>
    
    <!-- State Management -->
    <rect x="140" y="340" width="1020" height="80" fill="#e1f5fe" stroke="#0288d1" stroke-width="2" rx="5"/>
    <text x="650" y="365" font-family="Arial" font-size="16" font-weight="bold" fill="#01579b">
      Context &amp; State Management
    </text>
    <text x="160" y="390" font-family="Arial" font-size="13" fill="#333">
      • AppContext (Global State)
    </text>
    <text x="160" y="410" font-family="Arial" font-size="13" fill="#333">
      • VoiceContext (Voice Commands)
    </text>
    
    <!-- External Integrations -->
    <rect x="140" y="440" width="1020" height="60" fill="#fff3e0" stroke="#f57c00" stroke-width="2" rx="5"/>
    <text x="650" y="465" font-family="Arial" font-size="16" font-weight="bold" fill="#e65100">
      External Integrations
    </text>
    <text x="160" y="485" font-family="Arial" font-size="12" fill="#333">
      • Google Maps API (Maps, Geocoding)    • Web Speech API (Voice Recognition)
    </text>
  </g>
  
  <!-- Connection Arrow -->
  <g id="connection-1">
    <line x1="700" y1="545" x2="700" y2="600" stroke="#34495e" stroke-width="4" marker-end="url(#arrowhead)"/>
    <text x="750" y="565" font-family="Arial" font-size="14" font-weight="bold" fill="#2c3e50">HTTP/HTTPS (REST API)</text>
    <text x="750" y="585" font-family="Arial" font-size="12" fill="#7f8c8d">CORS Enabled (localhost)</text>
  </g>
  
  <!-- ==================== APPLICATION LAYER ==================== -->
  <g id="application-layer">
    <rect x="50" y="610" width="1300" height="420" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="3" rx="10"/>
    <text x="700" y="640" font-family="Arial" font-size="20" font-weight="bold" text-anchor="middle" fill="#6a1b9a">
      APPLICATION LAYER
    </text>
    <line x1="50" y1="650" x2="1350" y2="650" stroke="#7b1fa2" stroke-width="2"/>
    
    <!-- Prediction API Service -->
    <rect x="120" y="680" width="550" height="320" fill="#ffffff" stroke="#9c27b0" stroke-width="2" rx="8"/>
    <text x="395" y="710" font-family="Arial" font-size="17" font-weight="bold" text-anchor="middle" fill="#7b1fa2">
      Prediction API Service (Port 5000)
    </text>
    
    <!-- Flask REST API -->
    <rect x="150" y="730" width="490" height="110" fill="#e1bee7" stroke="#8e24aa" stroke-width="2" rx="5"/>
    <text x="395" y="755" font-family="Arial" font-size="15" font-weight="bold" text-anchor="middle">Flask REST API</text>
    <text x="170" y="780" font-family="Arial" font-size="12" fill="#333">• /health</text>
    <text x="170" y="800" font-family="Arial" font-size="12" fill="#333">• /predict</text>
    <text x="170" y="820" font-family="Arial" font-size="12" fill="#333">• /predict/batch</text>
    <text x="380" y="800" font-family="Arial" font-size="12" fill="#333">• /model/info</text>
    
    <!-- Request Handler -->
    <rect x="150" y="855" width="220" height="70" fill="#f3e5f5" stroke="#8e24aa" stroke-width="2" rx="5"/>
    <text x="260" y="877" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle">Request Handler</text>
    <text x="170" y="897" font-family="Arial" font-size="11" fill="#333">• Validators</text>
    <text x="170" y="912" font-family="Arial" font-size="11" fill="#333">• Logger • Error Handler</text>
    
    <!-- CORS & Middleware -->
    <rect x="390" y="855" width="250" height="70" fill="#f3e5f5" stroke="#8e24aa" stroke-width="2" rx="5"/>
    <text x="515" y="885" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle">CORS &amp; Middleware</text>
    <text x="410" y="912" font-family="Arial" font-size="11" fill="#333">Security &amp; Logging</text>
    
    <!-- Fare Calculation Service -->
    <rect x="730" y="680" width="550" height="320" fill="#ffffff" stroke="#00897b" stroke-width="2" rx="8"/>
    <text x="1005" y="710" font-family="Arial" font-size="17" font-weight="bold" text-anchor="middle" fill="#00695c">
      Fare Calculation Service (Port 5001)
    </text>
    
    <!-- Fare Flask REST API -->
    <rect x="760" y="730" width="490" height="130" fill="#b2dfdb" stroke="#00897b" stroke-width="2" rx="5"/>
    <text x="1005" y="755" font-family="Arial" font-size="15" font-weight="bold" text-anchor="middle">Flask REST API</text>
    <text x="780" y="780" font-family="Arial" font-size="12" fill="#333">• /api/health</text>
    <text x="780" y="800" font-family="Arial" font-size="12" fill="#333">• /api/stops</text>
    <text x="780" y="820" font-family="Arial" font-size="12" fill="#333">• /api/calculate_fare</text>
    <text x="1000" y="800" font-family="Arial" font-size="12" fill="#333">• /api/journey/plan</text>
    <text x="1000" y="820" font-family="Arial" font-size="12" fill="#333">• /api/routes</text>
    
    <!-- GTFS Data Processor -->
    <rect x="760" y="875" width="220" height="110" fill="#e0f2f1" stroke="#00897b" stroke-width="2" rx="5"/>
    <text x="870" y="897" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle">GTFS Data Processor</text>
    <text x="780" y="917" font-family="Arial" font-size="11" fill="#333">• Parse stops.txt</text>
    <text x="780" y="932" font-family="Arial" font-size="11" fill="#333">• Parse routes.txt</text>
    <text x="780" y="947" font-family="Arial" font-size="11" fill="#333">• Parse fare_rules</text>
    <text x="780" y="962" font-family="Arial" font-size="11" fill="#333">• Calculate distance</text>
    
    <!-- Fare Calculator -->
    <rect x="1000" y="875" width="250" height="110" fill="#e0f2f1" stroke="#00897b" stroke-width="2" rx="5"/>
    <text x="1125" y="897" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle">Fare Calculator</text>
    <text x="1020" y="922" font-family="Arial" font-size="11" fill="#333">• Haversine formula</text>
    <text x="1020" y="942" font-family="Arial" font-size="11" fill="#333">• Tier-based pricing</text>
    <text x="1020" y="962" font-family="Arial" font-size="11" fill="#333">• GST calculation</text>
  </g>
  
  <!-- Connection Arrow -->
  <g id="connection-2">
    <line x1="700" y1="1035" x2="700" y2="1090" stroke="#34495e" stroke-width="4" marker-end="url(#arrowhead)"/>
  </g>
  
  <!-- ==================== MACHINE LEARNING LAYER ==================== -->
  <g id="ml-layer">
    <rect x="50" y="1100" width="1300" height="340" fill="#fff3e0" stroke="#f57c00" stroke-width="3" rx="10"/>
    <text x="700" y="1130" font-family="Arial" font-size="20" font-weight="bold" text-anchor="middle" fill="#e65100">
      MACHINE LEARNING LAYER
    </text>
    <line x1="50" y1="1140" x2="1350" y2="1140" stroke="#f57c00" stroke-width="2"/>
    
    <!-- ML Prediction Engine -->
    <rect x="100" y="1170" width="1200" height="250" fill="#ffffff" stroke="#fb8c00" stroke-width="2" rx="8"/>
    <text x="700" y="1200" font-family="Arial" font-size="18" font-weight="bold" text-anchor="middle" fill="#e65100">
      ML Prediction Engine
    </text>
    
    <!-- Random Forest -->
    <rect x="150" y="1220" width="320" height="130" fill="#ffe0b2" stroke="#f57c00" stroke-width="2" rx="5"/>
    <text x="310" y="1245" font-family="Arial" font-size="15" font-weight="bold" text-anchor="middle">Random Forest Classifier</text>
    <text x="170" y="1270" font-family="Arial" font-size="12" fill="#333">• 100 trees</text>
    <text x="170" y="1290" font-family="Arial" font-size="12" fill="#333">• max_depth=20</text>
    <text x="170" y="1310" font-family="Arial" font-size="12" fill="#333">• 66.83% accuracy</text>
    <text x="170" y="1330" font-family="Arial" font-size="12" fill="#333">• ~145ms response</text>
    
    <!-- Feature Engineering -->
    <rect x="500" y="1220" width="320" height="130" fill="#ffe0b2" stroke="#f57c00" stroke-width="2" rx="5"/>
    <text x="660" y="1245" font-family="Arial" font-size="15" font-weight="bold" text-anchor="middle">Feature Engineering</text>
    <text x="520" y="1270" font-family="Arial" font-size="12" fill="#333">• hour (0-23)</text>
    <text x="520" y="1290" font-family="Arial" font-size="12" fill="#333">• day_of_week (0-6)</text>
    <text x="520" y="1310" font-family="Arial" font-size="12" fill="#333">• is_rush_hour (0/1)</text>
    <text x="520" y="1330" font-family="Arial" font-size="12" fill="#333">• stop_lat, stop_lon</text>
    
    <!-- Scaler -->
    <rect x="850" y="1220" width="320" height="130" fill="#ffe0b2" stroke="#f57c00" stroke-width="2" rx="5"/>
    <text x="1010" y="1245" font-family="Arial" font-size="15" font-weight="bold" text-anchor="middle">Scaler (Optional)</text>
    <text x="870" y="1280" font-family="Arial" font-size="12" fill="#333">Normalization &amp;</text>
    <text x="870" y="1300" font-family="Arial" font-size="12" fill="#333">Standardization</text>
    
    <!-- Crowd Level Classification -->
    <rect x="150" y="1370" width="1020" height="40" fill="#ffcc80" stroke="#f57c00" stroke-width="2" rx="5"/>
    <text x="170" y="1393" font-family="Arial" font-size="13" font-weight="bold" fill="#333">
      Crowd Levels: 0-Low (&lt;25%) | 1-Medium (25-50%) | 2-High (50-75%) | 3-Very High (&gt;75%)
    </text>
  </g>
  
  <!-- Connection Arrow -->
  <g id="connection-3">
    <line x1="700" y1="1445" x2="700" y2="1500" stroke="#34495e" stroke-width="4" marker-end="url(#arrowhead)"/>
  </g>
  
  <!-- ==================== DATA LAYER ==================== -->
  <g id="data-layer">
    <rect x="50" y="1510" width="1300" height="280" fill="#e8f5e9" stroke="#388e3c" stroke-width="3" rx="10"/>
    <text x="700" y="1540" font-family="Arial" font-size="20" font-weight="bold" text-anchor="middle" fill="#2e7d32">
      DATA LAYER
    </text>
    <line x1="50" y1="1550" x2="1350" y2="1550" stroke="#388e3c" stroke-width="2"/>
    
    <!-- GTFS Static Data -->
    <rect x="120" y="1580" width="350" height="180" fill="#ffffff" stroke="#4caf50" stroke-width="2" rx="8"/>
    <text x="295" y="1610" font-family="Arial" font-size="16" font-weight="bold" text-anchor="middle" fill="#2e7d32">
      GTFS Static Data (CSV)
    </text>
    <text x="140" y="1635" font-family="Arial" font-size="12" fill="#333">• stops.txt</text>
    <text x="140" y="1655" font-family="Arial" font-size="12" fill="#333">• routes.txt</text>
    <text x="140" y="1675" font-family="Arial" font-size="12" fill="#333">• stop_times.txt</text>
    <text x="140" y="1695" font-family="Arial" font-size="12" fill="#333">• fare_rules.txt</text>
    <text x="140" y="1715" font-family="Arial" font-size="12" fill="#333">• shapes.txt</text>
    <text x="140" y="1735" font-family="Arial" font-size="12" fill="#333">• calendar.txt, trips.txt</text>
    
    <!-- ML Model Files -->
    <rect x="520" y="1580" width="350" height="180" fill="#ffffff" stroke="#4caf50" stroke-width="2" rx="8"/>
    <text x="695" y="1610" font-family="Arial" font-size="16" font-weight="bold" text-anchor="middle" fill="#2e7d32">
      ML Model Files (Pickled)
    </text>
    <text x="540" y="1635" font-family="Arial" font-size="12" fill="#333">• model.pkl</text>
    <text x="540" y="1655" font-family="Arial" font-size="12" fill="#333">• feature_info.pkl</text>
    <text x="540" y="1675" font-family="Arial" font-size="12" fill="#333">• scaler.pkl</text>
    <text x="540" y="1695" font-family="Arial" font-size="12" fill="#333">• metadata.json</text>
    <text x="540" y="1725" font-family="Arial" font-size="12" font-weight="bold" fill="#2e7d32">Training Data:</text>
    <text x="540" y="1745" font-family="Arial" font-size="12" fill="#333">• training_v2.csv (15K samples)</text>
    
    <!-- Bus Stop Data -->
    <rect x="920" y="1580" width="350" height="180" fill="#ffffff" stroke="#4caf50" stroke-width="2" rx="8"/>
    <text x="1095" y="1610" font-family="Arial" font-size="16" font-weight="bold" text-anchor="middle" fill="#2e7d32">
      Bus Stop Data
    </text>
    <text x="940" y="1645" font-family="Arial" font-size="13" font-weight="bold" fill="#2e7d32">Bus Stops:</text>
    <text x="940" y="1665" font-family="Arial" font-size="12" fill="#333">• 9360+ stops</text>
    <text x="940" y="1685" font-family="Arial" font-size="12" fill="#333">• GPS coordinates</text>
    <text x="940" y="1705" font-family="Arial" font-size="12" fill="#333">• Zone IDs</text>
    <text x="940" y="1730" font-family="Arial" font-size="13" font-weight="bold" fill="#2e7d32">Bus Routes:</text>
    <text x="940" y="1750" font-family="Arial" font-size="12" fill="#333">• 4190+ routes</text>
    
    <!-- Note -->
    <text x="700" y="1775" font-family="Arial" font-size="11" font-style="italic" text-anchor="middle" fill="#666">
      Note: Currently file-based storage. Future: PostgreSQL/MongoDB
    </text>
  </g>
  
  <!-- Connection Arrow -->
  <g id="connection-4">
    <line x1="700" y1="1795" x2="700" y2="1850" stroke="#34495e" stroke-width="4" marker-end="url(#arrowhead)"/>
  </g>
  
  <!-- ==================== INFRASTRUCTURE LAYER ==================== -->
  <g id="infrastructure-layer">
    <rect x="50" y="1860" width="1300" height="120" fill="#fce4ec" stroke="#c2185b" stroke-width="3" rx="10"/>
    <text x="700" y="1890" font-family="Arial" font-size="20" font-weight="bold" text-anchor="middle" fill="#ad1457">
      INFRASTRUCTURE LAYER
    </text>
    <line x1="50" y1="1900" x2="1350" y2="1900" stroke="#c2185b" stroke-width="2"/>
    
    <!-- Development -->
    <rect x="120" y="1920" width="280" height="50" fill="#f8bbd0" stroke="#c2185b" stroke-width="2" rx="5"/>
    <text x="260" y="1943" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle">Development</text>
    <text x="140" y="1960" font-family="Arial" font-size="11" fill="#333">Local • Hot reload • Debug</text>
    
    <!-- Testing -->
    <rect x="460" y="1920" width="280" height="50" fill="#f8bbd0" stroke="#c2185b" stroke-width="2" rx="5"/>
    <text x="600" y="1943" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle">Testing</text>
    <text x="480" y="1960" font-family="Arial" font-size="11" fill="#333">pytest • Coverage • Mock data</text>
    
    <!-- Production -->
    <rect x="800" y="1920" width="280" height="50" fill="#f8bbd0" stroke="#c2185b" stroke-width="2" rx="5"/>
    <text x="940" y="1943" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle">Production</text>
    <text x="820" y="1960" font-family="Arial" font-size="11" fill="#333">Cloud VPS • nginx • gunicorn</text>
  </g>
  
  <!-- Arrow marker definition -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#34495e"/>
    </marker>
  </defs>
  
  <!-- Footer -->
  <text x="700" y="1995" font-family="Arial" font-size="11" text-anchor="middle" fill="#7f8c8d">
    BusFlow System Architecture v1.0 | January 2025
  </text>
</svg>